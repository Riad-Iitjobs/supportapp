<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Support - SupportHub</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="mobile-container">
    <!-- Header -->
    <header class="header">
      <h1 class="header-title">Support Chat</h1>
      <div class="header-actions">
        <button class="icon-btn" onclick="window.location.href='index.html'">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Chat Container -->
    <div class="chat-container">
      <!-- Messages Area -->
      <div class="chat-messages" id="chat-messages">
        <div class="message">
          <div class="message-avatar">AI</div>
          <div class="message-bubble">
            Hello! I'm your SupportHub AI assistant. How can I help you today?
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="chat-input-container">
        <form class="chat-input-form" id="chat-form" onsubmit="handleSendMessage(event)">
          <input
            type="text"
            class="chat-input"
            id="chat-input"
            placeholder="Type your message..."
            autocomplete="off"
            required
          >
          <button type="submit" class="chat-send-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
          </button>
        </form>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="index.html" class="nav-item">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
        <span>Home</span>
      </a>
      <a href="tickets.html" class="nav-item">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
        </svg>
        <span>Tickets</span>
      </a>
      <a href="chat.html" class="nav-item active">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <span>Chat</span>
      </a>
      <a href="login.html" class="nav-item">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        <span>Account</span>
      </a>
    </nav>
  </div>

  <script src="app.js"></script>
  <script>
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');

    // Sample bot responses
    const botResponses = {
      greetings: [
        "Hi there! How can I assist you today?",
        "Hello! What can I help you with?",
        "Hey! I'm here to help. What's on your mind?"
      ],
      help: [
        "I can help you with:\n• Submitting support tickets\n• Account issues\n• Technical questions\n• Billing inquiries\n\nWhat would you like help with?"
      ],
      ticket: [
        "I can help you create a support ticket! Would you like to go to the ticket submission page, or would you prefer to describe your issue here first?"
      ],
      billing: [
        "For billing questions, I recommend creating a ticket through our ticket system. This ensures your inquiry is handled by our billing team securely."
      ],
      technical: [
        "I'd be happy to help with technical issues! Can you describe the problem you're experiencing in more detail?"
      ],
      account: [
        "For account-related questions, please visit the Account page or create a support ticket for personalized assistance."
      ],
      default: [
        "I understand. Let me help you with that. Could you provide more details?",
        "Thanks for reaching out! Can you tell me more about what you need?",
        "I'm here to help! Could you elaborate on your question?"
      ]
    };

    function addMessage(text, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : ''}`;

      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.textContent = isUser ? 'U' : 'AI';

      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      bubble.textContent = text;

      messageDiv.appendChild(avatar);
      messageDiv.appendChild(bubble);
      chatMessages.appendChild(messageDiv);

      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getBotResponse(userMessage) {
      const message = userMessage.toLowerCase();

      if (message.match(/\b(hi|hello|hey|greetings)\b/)) {
        return botResponses.greetings[Math.floor(Math.random() * botResponses.greetings.length)];
      } else if (message.match(/\b(help|support)\b/)) {
        return botResponses.help[0];
      } else if (message.match(/\b(ticket|issue|problem)\b/)) {
        return botResponses.ticket[0];
      } else if (message.match(/\b(billing|payment|invoice|charge)\b/)) {
        return botResponses.billing[0];
      } else if (message.match(/\b(technical|bug|error|broken)\b/)) {
        return botResponses.technical[0];
      } else if (message.match(/\b(account|login|password|profile)\b/)) {
        return botResponses.account[0];
      } else {
        return botResponses.default[Math.floor(Math.random() * botResponses.default.length)];
      }
    }

    function handleSendMessage(event) {
      event.preventDefault();

      const message = chatInput.value.trim();
      if (!message) return;

      // Add user message
      addMessage(message, true);

      // Clear input
      chatInput.value = '';

      // Simulate bot typing and response
      setTimeout(() => {
        const response = getBotResponse(message);
        addMessage(response);
      }, 500 + Math.random() * 1000);
    }

    // Get current user
    const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
    const userId = currentUser.userId || null;

    // Load chat history for this user from localStorage
    if (userId) {
      const allChats = JSON.parse(localStorage.getItem('userChats') || '{}');
      const userChatHistory = allChats[userId] || [];

      userChatHistory.forEach(msg => {
        addMessage(msg.text, msg.isUser);
      });
    }

    // Save chat messages per user
    const originalAddMessage = addMessage;
    addMessage = function(text, isUser = false) {
      originalAddMessage(text, isUser);

      if (userId) {
        const allChats = JSON.parse(localStorage.getItem('userChats') || '{}');
        if (!allChats[userId]) {
          allChats[userId] = [];
        }
        allChats[userId].push({
          text,
          isUser,
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('userChats', JSON.stringify(allChats));
      }
    };
  </script>
</body>
</html>
